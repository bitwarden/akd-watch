services:
  akd-watch-auditor:
    build:
      context: ..
      dockerfile: docker/Dockerfile.auditor
    image: akd-watch/auditor:latest
    environment:
      - AKD_WATCH_CONFIG_PATH=/etc/akd-watch/config
      - AKD_WATCH__DATA_DIRECTORY=/var/lib/akd-watch
    volumes:
      # Configuration file
      - ./config.toml:/etc/akd-watch/config.toml:ro
      # Shared persistent storage volumes
      - ./data:/var/lib/akd-watch:rw
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    read_only: false
    tmpfs:
      - /tmp:noexec,nosuid,size=100m

  akd-watch-web:
    build:
      context: ..
      dockerfile: docker/Dockerfile.web
    image: akd-watch/web:latest
    ports:
      - "3000:3000"
    environment:
      - AKD_WATCH_CONFIG_PATH=/etc/akd-watch/config
      - AKD_WATCH__DATA_DIRECTORY=/var/lib/akd-watch
    volumes:
      # Configuration file
      - ./config.toml:/etc/akd-watch/config.toml:ro
      # Shared persistent storage volumes (same as auditor)
      - ./data:/var/lib/akd-watch:ro
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
